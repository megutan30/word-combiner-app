<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å˜èªçµ„ã¿åˆã‚ã›ã‚¢ãƒ—ãƒª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            text-align: center;
            padding: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .content {
            padding: 40px;
        }

        .mode-selector {
            background: linear-gradient(135deg, #a8e6cf, #88d8a3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .mode-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .mode-btn {
            background: white;
            border: 3px solid #88d8a3;
            color: #2d3436;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .mode-btn.active {
            background: #00b894;
            color: white;
            border-color: #00a085;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 184, 148, 0.3);
        }

        .mode-btn:hover:not(.active) {
            background: #f8f9fa;
            transform: translateY(-1px);
        }

        .box-count-selector {
            background: linear-gradient(135deg, #fdcb6e, #f39c12);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .box-count-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .box-count-btn {
            background: white;
            border: 2px solid #f39c12;
            color: #2d3436;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            min-width: 50px;
        }

        .box-count-btn:hover {
            background: #f39c12;
            color: white;
            transform: translateY(-1px);
        }

        .box-count-display {
            background: white;
            border: 3px solid #f39c12;
            color: #2d3436;
            padding: 12px 24px;
            border-radius: 15px;
            font-size: 20px;
            font-weight: bold;
            min-width: 80px;
            text-align: center;
        }

        .section {
            margin-bottom: 40px;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #ff6b6b;
            padding-bottom: 10px;
        }

        .category-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        .category-tab {
            background: #f1f2f6;
            border: 2px solid #ddd;
            color: #2d3436;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-size: 14px;
            white-space: nowrap;
        }

        .category-tab.active {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border-color: #ff6b6b;
        }

        .category-tab:hover:not(.active) {
            background: #e8e9ea;
        }

        .input-mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .input-mode-btn {
            background: #f1f2f6;
            border: 2px solid #ddd;
            color: #2d3436;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-size: 14px;
        }

        .input-mode-btn.active {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            border-color: #00b894;
        }

        .input-mode-btn:hover:not(.active) {
            background: #e8e9ea;
        }

        .bulk-input-section {
            margin-bottom: 20px;
        }

        .bulk-input {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
            margin-bottom: 10px;
        }

        .bulk-input:focus {
            outline: none;
            border-color: #ff6b6b;
        }

        .bulk-input-controls {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .clear-btn {
            background: linear-gradient(135deg, #636e72, #2d3436);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .clear-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(99, 110, 114, 0.3);
        }

        .word-input-section {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .word-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .word-input:focus {
            outline: none;
            border-color: #ff6b6b;
        }

        .add-btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(255, 107, 107, 0.3);
        }

        .word-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            min-height: 50px;
            padding: 15px;
            border: 2px dashed #ddd;
            border-radius: 10px;
            background: #f9f9f9;
        }

        .word-tag {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: fadeIn 0.3s;
        }

        .word-tag.box1 { background: linear-gradient(135deg, #ff7675, #e17055); }
        .word-tag.box2 { background: linear-gradient(135deg, #6c5ce7, #a29bfe); }
        .word-tag.box3 { background: linear-gradient(135deg, #00b894, #00a085); }
        .word-tag.box4 { background: linear-gradient(135deg, #fdcb6e, #f39c12); }
        .word-tag.box5 { background: linear-gradient(135deg, #e84393, #d63031); }
        .word-tag.box6 { background: linear-gradient(135deg, #fd79a8, #e84393); }
        .word-tag.box7 { background: linear-gradient(135deg, #74b9ff, #0984e3); }
        .word-tag.box8 { background: linear-gradient(135deg, #a29bfe, #6c5ce7); }
        .word-tag.box9 { background: linear-gradient(135deg, #55a3ff, #3742fa); }
        .word-tag.box10 { background: linear-gradient(135deg, #26de81, #20bf6b); }

        .word-tag .remove-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .list-controls {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 15px;
        }

        .preset-btn {
            background: linear-gradient(135deg, #8e44ad, #7d3c98);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .preset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(142, 68, 173, 0.3);
        }

        .bulk-select-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .bulk-select-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        .bulk-select-btn.active {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .bulk-delete-section {
            background: #ffe6e6;
            border: 2px solid #ffcccc;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .bulk-delete-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .select-all-btn, .deselect-all-btn, .cancel-selection-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .select-all-btn:hover, .deselect-all-btn:hover, .cancel-selection-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .delete-selected-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
        }

        .delete-selected-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #c0392b, #a93226);
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        .delete-selected-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .word-tag.selectable {
            cursor: pointer;
            position: relative;
        }

        .word-tag.selectable:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .word-tag.selected {
            background: linear-gradient(135deg, #e74c3c, #c0392b) !important;
            transform: scale(0.95);
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .word-tag .selection-indicator {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .preset-panel {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 2px solid #8e44ad;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(142, 68, 173, 0.1);
        }

        .preset-panel h4 {
            color: #8e44ad;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.2em;
        }

        .preset-panel h5 {
            color: #6c757d;
            margin: 15px 0 10px 0;
            font-size: 1em;
        }

        .preset-save-section, .preset-load-section {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #dee2e6;
        }

        .preset-save-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .preset-save-controls input {
            flex: 1;
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .preset-save-controls input:focus {
            outline: none;
            border-color: #8e44ad;
        }

        .save-preset-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .save-preset-btn:hover {
            background: linear-gradient(135deg, #20c997, #17a2b8);
            transform: translateY(-1px);
        }

        .current-preset-info {
            font-size: 0.9em;
            color: #6c757d;
            font-style: italic;
        }

        .preset-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .no-presets {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 20px;
        }

        .preset-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .preset-item:hover {
            background: #e9ecef;
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .preset-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .preset-name {
            font-weight: bold;
            color: #495057;
            font-size: 1.1em;
        }

        .preset-info {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 10px;
        }

        .preset-actions {
            display: flex;
            gap: 8px;
        }

        .load-preset-btn {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .load-preset-btn:hover {
            background: linear-gradient(135deg, #0056b3, #004085);
            transform: translateY(-1px);
        }

        .delete-preset-btn {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .delete-preset-btn:hover {
            background: linear-gradient(135deg, #c82333, #bd2130);
            transform: translateY(-1px);
        }

        .preset-panel-controls {
            text-align: center;
            margin-top: 20px;
        }

        .close-preset-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 30px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .close-preset-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .backup-section {
            background: #f0f8ff;
            border: 1px solid #0066cc;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .backup-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .backup-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(0, 102, 204, 0.1);
            border-radius: 8px;
            font-size: 0.9em;
        }

        .auto-backup-status {
            color: #0066cc;
            font-weight: bold;
        }

        .backup-count {
            color: #666;
        }

        .backup-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .manual-backup-btn, .export-backup-btn, .import-backup-btn, .restore-backup-btn {
            background: linear-gradient(135deg, #0066cc, #004499);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            flex: 1;
            min-width: 100px;
        }

        .manual-backup-btn:hover, .export-backup-btn:hover, .import-backup-btn:hover, .restore-backup-btn:hover {
            background: linear-gradient(135deg, #004499, #003366);
            transform: translateY(-1px);
        }

        .backup-list-panel {
            background: linear-gradient(135deg, #f0f8ff, #e6f3ff);
            border: 2px solid #0066cc;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0, 102, 204, 0.1);
        }

        .backup-list-panel h4 {
            color: #0066cc;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.2em;
        }

        .backup-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .no-backups {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 20px;
        }

        .backup-item {
            background: white;
            border: 1px solid #0066cc;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .backup-item:hover {
            background: #f0f8ff;
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0, 102, 204, 0.2);
        }

        .backup-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .backup-name {
            font-weight: bold;
            color: #0066cc;
            font-size: 1.1em;
        }

        .backup-type {
            background: #0066cc;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8em;
        }

        .backup-info-detail {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 10px;
        }

        .backup-actions-detail {
            display: flex;
            gap: 8px;
        }

        .restore-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .restore-btn:hover {
            background: linear-gradient(135deg, #20c997, #17a2b8);
            transform: translateY(-1px);
        }

        .delete-backup-btn {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .delete-backup-btn:hover {
            background: linear-gradient(135deg, #c82333, #bd2130);
            transform: translateY(-1px);
        }

        .backup-panel-controls {
            text-align: center;
            margin-top: 20px;
        }

        .close-backup-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 30px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .close-backup-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .generate-btn {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-bottom: 30px;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 184, 148, 0.3);
        }

        .generate-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .result-section {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
        }

        .word-boxes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }

        @media (max-width: 768px) {
            .word-boxes {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .word-boxes {
                grid-template-columns: 1fr;
            }
        }

        .word-box {
            background: white;
            border: 3px solid;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .word-box.box1 { border-color: #ff7675; }
        .word-box.box2 { border-color: #6c5ce7; }
        .word-box.box3 { border-color: #00b894; }
        .word-box.box4 { border-color: #fdcb6e; }
        .word-box.box5 { border-color: #e84393; }
        .word-box.box6 { border-color: #fd79a8; }
        .word-box.box7 { border-color: #74b9ff; }
        .word-box.box8 { border-color: #a29bfe; }
        .word-box.box9 { border-color: #55a3ff; }
        .word-box.box10 { border-color: #26de81; }

        .word-box:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .word-box.active {
            border-color: #00b894;
            background: #e8f5f0;
        }

        .word-box .word-text {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
            word-break: break-word;
        }

        .word-box .hint {
            font-size: 0.8em;
            color: #666;
        }

        .word-box .category-label {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.1);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7em;
            color: #666;
        }

        .pin-btn {
            position: absolute;
            top: 5px;
            left: 5px;
            background: rgba(255, 193, 7, 0.8);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7;
        }

        .pin-btn:hover {
            background: rgba(255, 193, 7, 1);
            opacity: 1;
            transform: scale(1.1);
            box-shadow: 0 3px 10px rgba(255, 193, 7, 0.4);
        }

        .pin-btn.pinned {
            background: rgba(255, 193, 7, 1);
            opacity: 1;
            transform: rotate(45deg);
            box-shadow: 0 3px 10px rgba(255, 193, 7, 0.6);
        }

        .pin-btn:active {
            transform: scale(0.95);
        }

        .pin-btn.pinned:active {
            transform: rotate(45deg) scale(0.95);
        }

        .word-box.pinned {
            border-color: #ffc107;
            background: linear-gradient(135deg, #fff9e6, #fff3cd);
            box-shadow: 0 5px 15px rgba(255, 193, 7, 0.3);
        }

        .word-box.pinned .hint {
            color: #856404;
            font-weight: bold;
        }

        .dislike-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: rgba(255, 99, 71, 0.8);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7;
        }

        .dislike-btn:hover {
            background: rgba(255, 99, 71, 1);
            opacity: 1;
            transform: scale(1.1);
            box-shadow: 0 3px 10px rgba(255, 99, 71, 0.4);
        }

        .dislike-btn:active {
            transform: scale(0.95);
        }

        .replacement-panel {
            background: white;
            border: 2px solid #ddd;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            animation: slideDown 0.3s;
        }

        .replacement-words {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .replacement-word {
            background: #f1f2f6;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .replacement-word:hover {
            background: #ff6b6b;
            color: white;
            border-color: #ff6b6b;
        }

        .excluded-words-section {
            background: #fff5f5;
            border: 2px solid #ffcccb;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .excluded-words-section h4 {
            color: #dc3545;
            margin-bottom: 10px;
        }

        .excluded-words-section p {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .excluded-words {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .excluded-word {
            background: #f8d7da;
            border: 2px solid #f5c6cb;
            border-radius: 10px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .excluded-word:hover {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .excluded-word::after {
            content: "ã‚¯ãƒªãƒƒã‚¯ã§å¾©æ´»";
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }

        .excluded-word:hover::after {
            opacity: 1;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        .empty-state {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }

            .mode-buttons, .box-count-controls {
                flex-direction: column;
                align-items: center;
            }

            .category-tabs {
                justify-content: center;
            }

            .list-controls {
                flex-direction: column;
                gap: 8px;
            }

            .word-input-section {
                flex-direction: column;
            }

            .preset-save-controls {
                flex-direction: column;
                gap: 8px;
            }

            .preset-actions {
                flex-direction: column;
                gap: 5px;
            }

            .backup-actions {
                flex-direction: column;
                gap: 5px;
            }

            .backup-actions button, .backup-actions label {
                width: 100%;
                min-width: auto;
            }

            .backup-actions-detail {
                flex-direction: column;
                gap: 5px;
            }

            .backup-actions-detail button {
                width: 100%;
            }

            .bulk-delete-controls {
                flex-direction: column;
                gap: 8px;
            }

            .bulk-delete-controls button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ² å˜èªçµ„ã¿åˆã‚ã›ã‚¢ãƒ—ãƒª</h1>
            <p>å˜èªã‚’ç™»éŒ²ã—ã¦ãƒ©ãƒ³ãƒ€ãƒ ãªçµ„ã¿åˆã‚ã›ã‚’æ¥½ã—ã‚‚ã†ï¼</p>
        </div>
        
        <div class="content">
            <!-- ãƒ¢ãƒ¼ãƒ‰é¸æŠ -->
            <div class="mode-selector">
                <h3>ğŸ¯ ãƒ¢ãƒ¼ãƒ‰é¸æŠ</h3>
                <p>å˜èªã®ç®¡ç†æ–¹æ³•ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
                <div class="mode-buttons">
                    <button class="mode-btn active" onclick="setMode('mixed')">
                        ğŸŒˆ ãƒŸãƒƒã‚¯ã‚¹ãƒ¢ãƒ¼ãƒ‰<br>
                        <small>å…¨ã¦ã®å˜èªã‹ã‚‰é¸æŠ</small>
                    </button>
                    <button class="mode-btn" onclick="setMode('category')">
                        ğŸ“‚ ã‚«ãƒ†ã‚´ãƒªãƒ¢ãƒ¼ãƒ‰<br>
                        <small>ãƒœãƒƒã‚¯ã‚¹ã”ã¨ã«å°‚ç”¨ãƒªã‚¹ãƒˆ</small>
                    </button>
                </div>
            </div>

            <!-- ãƒœãƒƒã‚¯ã‚¹æ•°é¸æŠ -->
            <div class="box-count-selector">
                <h3>ğŸ“¦ ãƒœãƒƒã‚¯ã‚¹æ•°è¨­å®š</h3>
                <p>çµ„ã¿åˆã‚ã›ã‚‹ãƒœãƒƒã‚¯ã‚¹ã®æ•°ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼ˆ2ï½10å€‹ï¼‰</p>
                <div class="box-count-controls">
                    <button class="box-count-btn" onclick="changeBoxCount(-1)">-</button>
                    <div class="box-count-display" id="boxCountDisplay">2</div>
                    <button class="box-count-btn" onclick="changeBoxCount(1)">+</button>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ“ å˜èªã‚’è¿½åŠ </h2>
                
                <!-- ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ–ï¼ˆã‚«ãƒ†ã‚´ãƒªãƒ¢ãƒ¼ãƒ‰ã®ã¿è¡¨ç¤ºï¼‰ -->
                <div class="category-tabs hidden" id="categoryTabs">
                    <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
                </div>
                
                <!-- å˜èªè¿½åŠ æ–¹æ³•ã®åˆ‡ã‚Šæ›¿ãˆ -->
                <div class="input-mode-selector">
                    <button class="input-mode-btn active" onclick="setInputMode('single')" id="singleModeBtn">
                        âœï¸ å€‹åˆ¥å…¥åŠ›
                    </button>
                    <button class="input-mode-btn" onclick="setInputMode('bulk')" id="bulkModeBtn">
                        ğŸ“ ã¾ã¨ã‚ã¦å…¥åŠ›
                    </button>
                </div>
                
                <!-- å€‹åˆ¥å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰ -->
                <div class="word-input-section" id="singleInputSection">
                    <input type="text" class="word-input" id="wordInput" placeholder="å˜èªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
                    <button class="add-btn" onclick="addWord()">è¿½åŠ </button>
                </div>
                
                <!-- ã¾ã¨ã‚ã¦å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰ -->
                <div class="bulk-input-section hidden" id="bulkInputSection">
                    <textarea class="bulk-input" id="bulkInput" placeholder="è¤‡æ•°ã®å˜èªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆæ”¹è¡Œã€ã‚«ãƒ³ãƒã€ã‚¹ãƒšãƒ¼ã‚¹ã§åŒºåˆ‡ã‚Šï¼‰&#10;ä¾‹ï¼š&#10;ç¾ã—ã„&#10;å¼·ã„, è³¢ã„&#10;å„ªã—ã„ å‹‡æ•¢ãª"></textarea>
                    <div class="bulk-input-controls">
                        <button class="add-btn" onclick="addBulkWords()">ã¾ã¨ã‚ã¦è¿½åŠ </button>
                        <button class="clear-btn" onclick="clearBulkInput()">ã‚¯ãƒªã‚¢</button>
                    </div>
                </div>
                
                <div class="word-list" id="wordList">
                    <div class="empty-state">ã¾ã å˜èªãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</div>
                </div>
                
                <!-- ã¾ã¨ã‚ã¦å‰Šé™¤æ©Ÿèƒ½ -->
                <div class="bulk-delete-section" id="bulkDeleteSection" style="display: none;">
                    <div class="bulk-delete-controls">
                        <button class="select-all-btn" onclick="selectAllWords()">å…¨é¸æŠ</button>
                        <button class="deselect-all-btn" onclick="deselectAllWords()">é¸æŠè§£é™¤</button>
                        <button class="delete-selected-btn" onclick="deleteSelectedWords()" id="deleteSelectedBtn" disabled>
                            é¸æŠã—ãŸå˜èªã‚’å‰Šé™¤ (<span id="selectedCount">0</span>å€‹)
                        </button>
                        <button class="cancel-selection-btn" onclick="cancelSelection()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>
                </div>
                
                <div class="list-controls">
                    <button class="preset-btn" onclick="showPresetPanel()" id="presetBtn">
                        ğŸ’¾ ãƒ—ãƒªã‚»ãƒƒãƒˆç®¡ç†
                    </button>
                    <button class="bulk-select-btn" onclick="toggleBulkSelectMode()" id="bulkSelectBtn">
                        âœ… ã¾ã¨ã‚ã¦å‰Šé™¤
                    </button>
                </div>

                <!-- ãƒ—ãƒªã‚»ãƒƒãƒˆç®¡ç†ãƒ‘ãƒãƒ« -->
                <div class="preset-panel" id="presetPanel" style="display: none;">
                    <h4>ğŸ“¦ ãƒ—ãƒªã‚»ãƒƒãƒˆç®¡ç†</h4>
                    
                    <!-- ä¿å­˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                    <div class="preset-save-section">
                        <h5>ğŸ’¾ ç¾åœ¨ã®å˜èªã‚»ãƒƒãƒˆã‚’ä¿å­˜</h5>
                        <div class="preset-save-controls">
                            <input type="text" id="presetNameInput" placeholder="ãƒ—ãƒªã‚»ãƒƒãƒˆåã‚’å…¥åŠ›..." maxlength="50">
                            <button class="save-preset-btn" onclick="saveCurrentPreset()">ä¿å­˜</button>
                        </div>
                        <div class="current-preset-info">
                            <span id="currentWordsCount">0</span>å€‹ã®å˜èªãŒä¿å­˜ã•ã‚Œã¾ã™
                        </div>
                    </div>

                    <!-- ãƒ­ãƒ¼ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                    <div class="preset-load-section">
                        <h5>ğŸ“‚ ä¿å­˜æ¸ˆã¿ãƒ—ãƒªã‚»ãƒƒãƒˆ</h5>
                        <div class="preset-list" id="presetList">
                            <div class="no-presets">ä¿å­˜ã•ã‚ŒãŸãƒ—ãƒªã‚»ãƒƒãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</div>
                        </div>
                    </div>

                    <!-- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                    <div class="backup-section">
                        <h5>ğŸ›¡ï¸ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç®¡ç†</h5>
                        <div class="backup-controls">
                            <div class="backup-info">
                                <div class="auto-backup-status" id="autoBackupStatus">
                                    ğŸ”„ è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: <span id="autoBackupTime">æœªå®Ÿè¡Œ</span>
                                </div>
                                <div class="backup-count">
                                    ğŸ“¦ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ•°: <span id="backupCount">0</span>å€‹
                                </div>
                            </div>
                            <div class="backup-actions">
                                <button class="manual-backup-btn" onclick="createManualBackup()">ğŸ“¥ æ‰‹å‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</button>
                                <button class="export-backup-btn" onclick="exportBackup()">ğŸ“¤ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                                <label class="import-backup-btn" for="importFile">ğŸ“‚ ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importBackup(event)">
                                </label>
                                <button class="restore-backup-btn" onclick="showBackupList()">ğŸ”„ å¾©å…ƒ</button>
                            </div>
                        </div>
                    </div>

                    <div class="preset-panel-controls">
                        <button class="close-preset-btn" onclick="hidePresetPanel()">é–‰ã˜ã‚‹</button>
                    </div>
                </div>

                <!-- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒªã‚¹ãƒˆãƒ‘ãƒãƒ« -->
                <div class="backup-list-panel" id="backupListPanel" style="display: none;">
                    <h4>ğŸ”„ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¾©å…ƒ</h4>
                    <div class="backup-list" id="backupList">
                        <div class="no-backups">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒã‚ã‚Šã¾ã›ã‚“</div>
                    </div>
                    <div class="backup-panel-controls">
                        <button class="close-backup-btn" onclick="hideBackupList()">é–‰ã˜ã‚‹</button>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <button class="generate-btn" id="generateBtn" onclick="generateRandomCombination()" disabled>
                    ğŸ¯ ãƒ©ãƒ³ãƒ€ãƒ ãªçµ„ã¿åˆã‚ã›ã‚’ç”Ÿæˆ
                </button>
                
                <div class="result-section" id="resultSection" style="display: none;">
                    <h3>âœ¨ ä»Šæ—¥ã®çµ„ã¿åˆã‚ã›</h3>
                    <div class="word-boxes" id="wordBoxes">
                        <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
                    </div>
                </div>
                
                <div class="replacement-panel" id="replacementPanel" style="display: none;">
                    <h4>ğŸ”„ å˜èªã‚’é¸æŠã—ã¦ãã ã•ã„</h4>
                    <div class="replacement-words" id="replacementWords"></div>
                </div>

                <!-- é™¤å¤–ã•ã‚ŒãŸå˜èªã®ç®¡ç† -->
                <div class="excluded-words-section" id="excludedWordsSection" style="display: none;">
                    <h4>ğŸš« é™¤å¤–ã•ã‚ŒãŸå˜èª</h4>
                    <p>é™¤å¤–ã•ã‚ŒãŸå˜èªã¯ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆã«å«ã¾ã‚Œã¾ã›ã‚“ã€‚ã‚¯ãƒªãƒƒã‚¯ã§å¾©æ´»ã§ãã¾ã™ã€‚</p>
                    <div class="excluded-words" id="excludedWords"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentMode = 'mixed'; // 'mixed' or 'category'
        let boxCount = 2; // ç¾åœ¨ã®ãƒœãƒƒã‚¯ã‚¹æ•°
        let activeCategory = 1; // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚«ãƒ†ã‚´ãƒªï¼ˆã‚«ãƒ†ã‚´ãƒªãƒ¢ãƒ¼ãƒ‰ç”¨ï¼‰
        let inputMode = 'single'; // 'single' or 'bulk'
        
        // ãƒŸãƒƒã‚¯ã‚¹ãƒ¢ãƒ¼ãƒ‰ç”¨
        let mixedWords = [];
        let excludedMixedWords = [];
        
        // ã‚«ãƒ†ã‚´ãƒªãƒ¢ãƒ¼ãƒ‰ç”¨ï¼ˆæœ€å¤§10ãƒœãƒƒã‚¯ã‚¹åˆ†ï¼‰
        let categoryWords = {};
        let excludedCategoryWords = {};
        
        // ç¾åœ¨ã®å˜èªã¨ãƒ”ãƒ³çŠ¶æ…‹
        let currentWords = {};
        let pinnedWords = {};
        
        let selectedBox = 0;
        let bulkSelectMode = false;
        let selectedWords = new Set();
        
        // ãƒ—ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ç”¨
        let savedPresets = {};
        let presetCounter = 0;
        
        // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ©Ÿèƒ½ç”¨
        let backupData = {};
        let backupCounter = 0;
        let autoBackupInterval = null;
        let lastAutoBackup = null;

        // åˆæœŸå˜èªãƒ‡ãƒ¼ã‚¿
        const initialWords = {
            mixed: [
                'HP', 'MP', 'ã‚²ãƒ¼ã‚¸', 'ç”»é¢', 'ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼', 'ã‚ªãƒ—ã‚·ãƒ§ãƒ³', 'ã‚¿ã‚¤ãƒˆãƒ«', 'åˆ¤å®š', 'ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤', 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼', 
                'ç§»å‹•', 'ã‚¹ãƒ†ã‚£ãƒƒã‚¯', 'ãƒœã‚¿ãƒ³', 'ã‚¸ãƒ£ãƒ³ãƒ«', 'ãƒ­ãƒ¼ã‚°ãƒ©ã‚¤ã‚¯', 'æ–‡å­—', 'è§£åƒåº¦', 'ãƒ•ã‚©ãƒ³ãƒˆ', 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼', 'ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒª',
                'ã‚¨ãƒ³ã‚¸ãƒ³', 'ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯', 'ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£', 'ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ', 'OS', 'ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢', 'CPU', 'GPU', 'ãƒ¡ãƒ¢ãƒª', 'ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸', 
                'å¸¯åŸŸå¹…', 'ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·', 'ã‚µãƒ¼ãƒãƒ¼', 'ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ', 'ãƒ”ã‚¢ãƒ„ãƒ¼ãƒ”ã‚¢', 'ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆ', 'V-Sync', 'ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°', 'æç”»', 'æœ€é©åŒ–'
            ],
            categories: {
                1: ['HP', 'MP', 'ã‚²ãƒ¼ã‚¸', 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', 'ãƒ¬ãƒ™ãƒ«', 'çµŒé¨“å€¤', 'ã‚¹ã‚­ãƒ«', 'æ”»æ’ƒåŠ›', 'é˜²å¾¡åŠ›', 'ç´ æ—©ã•', 'é­”åŠ›', 'é‹', 'ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«', 'å›é¿', 'å‘½ä¸­', 'è€æ€§'],
                2: ['ç”»é¢', 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼', 'ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒª', 'HUD', 'ãƒŸãƒ‹ãƒãƒƒãƒ—', 'ã‚¢ã‚¤ã‚³ãƒ³', 'ã‚«ãƒ¼ã‚½ãƒ«', 'ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—', 'ãƒ€ã‚¤ã‚¢ãƒ­ã‚°', 'ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—', 'ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼', 'ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹'],
                3: ['æ­¦å™¨', 'é˜²å…·', 'ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼', 'æ¶ˆè€—å“', 'å›å¾©ã‚¢ã‚¤ãƒ†ãƒ ', 'ç´ æ', 'é€šè²¨', 'ãƒãƒ¼ã‚·ãƒ§ãƒ³', 'ã‚¨ãƒªã‚¯ã‚µãƒ¼', 'éµ', 'å®ç®±', 'ãƒ¬ã‚¢ãƒªãƒ†ã‚£', 'å“è³ª', 'è€ä¹…åº¦', 'é‡é‡', 'ã‚¨ãƒ³ãƒãƒ£ãƒ³ãƒˆ'],
                4: ['ãƒ¯ãƒ¼ãƒ«ãƒ‰', 'ã‚¹ãƒ†ãƒ¼ã‚¸', 'ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰', 'ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³', 'è¡—', 'æ‘', 'åŸ', 'å¡”', 'æ´çªŸ', 'æ£®', 'å±±', 'æµ·', 'ç ‚æ¼ ', 'æ°·åŸ', 'ç«å±±', 'ç©º'],
                5: ['æ”»æ’ƒ', 'é˜²å¾¡', 'é­”æ³•', 'ã‚¹ã‚­ãƒ«ç™ºå‹•', 'ã‚³ãƒ³ãƒœ', 'å¿…æ®ºæŠ€', 'ã‚¬ãƒ¼ãƒ‰', 'å›å¾©', 'ãƒãƒ•', 'ãƒ‡ãƒãƒ•', 'çŠ¶æ…‹ç•°å¸¸', 'æ¯’', 'éº»ç—º', 'çœ ã‚Š', 'æ··ä¹±', 'å…ˆåˆ¶æ”»æ’ƒ'],
                6: ['ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼', 'NPC', 'ãƒœã‚¹', 'ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼', 'ãƒ‰ãƒ©ã‚´ãƒ³', 'ã‚¹ãƒ©ã‚¤ãƒ ', 'ã‚´ãƒ–ãƒªãƒ³', 'ã‚¨ãƒ«ãƒ•', 'ãƒ‰ãƒ¯ãƒ¼ãƒ•', 'ã‚¢ãƒã‚¿ãƒ¼', 'ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³', 'å¤–è¦‹', 'æœè£…', 'é«ªå‹'],
                7: ['ã‚¯ã‚¨ã‚¹ãƒˆ', 'ãƒŸãƒƒã‚·ãƒ§ãƒ³', 'ç›®æ¨™', 'ãƒãƒ£ãƒ¬ãƒ³ã‚¸', 'ãƒ‘ã‚ºãƒ«', 'è¬è§£ã', 'æ¢ç´¢', 'åé›†', 'è‚²æˆ', 'åˆæˆ', 'ã‚¯ãƒ©ãƒ•ãƒˆ', 'å»ºç¯‰', 'è¾²æ¥­', 'ã‚·ãƒŠãƒªã‚ª', 'è„šæœ¬', 'å°è©'],
                8: ['BGM', 'SE', 'ãƒœã‚¤ã‚¹', 'åŠ¹æœéŸ³', 'éŸ³é‡', 'ãƒŸãƒ¥ãƒ¼ãƒˆ', 'ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯', 'éŸ³éŸ¿åŠ¹æœ', 'æ®‹éŸ¿', 'ã‚¨ã‚³ãƒ¼', 'ãƒ‡ã‚£ã‚¹ãƒˆãƒ¼ã‚·ãƒ§ãƒ³', 'ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼', 'ã‚¤ã‚³ãƒ©ã‚¤ã‚¶ãƒ¼', 'ã‚³ãƒ³ãƒ—ãƒ¬ãƒƒã‚µãƒ¼'],
                9: ['ã‚»ãƒ¼ãƒ–', 'ãƒ­ãƒ¼ãƒ‰', 'ã‚ªãƒ¼ãƒˆã‚»ãƒ¼ãƒ–', 'ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ', 'é€²è¡Œåº¦', 'ã‚¯ãƒªã‚¢', 'ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼', 'ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ', 'ã‚³ãƒ³ãƒ†ã‚£ãƒ‹ãƒ¥ãƒ¼', 'ãƒ‹ãƒ¥ãƒ¼ã‚²ãƒ¼ãƒ ', 'å‘¨å›', 'ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°'],
                10: ['ã‚ªãƒ³ãƒ©ã‚¤ãƒ³', 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³', 'ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤', 'å”åŠ›ãƒ—ãƒ¬ã‚¤', 'å¯¾æˆ¦', 'ãƒ©ãƒ³ã‚­ãƒ³ã‚°', 'ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰', 'ãƒ•ãƒ¬ãƒ³ãƒ‰', 'ã‚®ãƒ«ãƒ‰', 'ãƒãƒ£ãƒƒãƒˆ', 'ãƒœã‚¤ã‚¹ãƒãƒ£ãƒƒãƒˆ', 'æ¥ç¶š', 'åˆ‡æ–­']
            }
        };

        // åˆæœŸåŒ–
        function initializeApp() {
            // åˆæœŸå˜èªãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®š
            mixedWords = [...initialWords.mixed];
            
            for (let i = 1; i <= 10; i++) {
                categoryWords[i] = initialWords.categories[i] ? [...initialWords.categories[i]] : [];
                excludedCategoryWords[i] = [];
                currentWords[i] = '';
                pinnedWords[i] = false;
            }
            
            updateUI();
            loadPresets();
            initializeBackupSystem();
        }

        function changeBoxCount(delta) {
            const newCount = boxCount + delta;
            if (newCount >= 2 && newCount <= 10) {
                boxCount = newCount;
                updateUI();
            }
        }

        function updateUI() {
            document.getElementById('boxCountDisplay').textContent = boxCount;
            updateCategoryTabs();
            updateWordBoxes();
            updateWordList();
            updateGenerateButton();
            updateExcludedWordsSection();
        }

        function updateCategoryTabs() {
            const tabsContainer = document.getElementById('categoryTabs');
            
            if (currentMode === 'category') {
                tabsContainer.classList.remove('hidden');
                tabsContainer.innerHTML = '';
                
                for (let i = 1; i <= boxCount; i++) {
                    const tab = document.createElement('div');
                    tab.className = `category-tab ${i === activeCategory ? 'active' : ''}`;
                    tab.textContent = `ğŸ“¦ ãƒœãƒƒã‚¯ã‚¹${i}ã®å˜èª`;
                    tab.onclick = () => setActiveCategory(i);
                    tabsContainer.appendChild(tab);
                }
            } else {
                tabsContainer.classList.add('hidden');
            }
        }

        function updateWordBoxes() {
            const container = document.getElementById('wordBoxes');
            container.innerHTML = '';
            
            for (let i = 1; i <= boxCount; i++) {
                const box = document.createElement('div');
                box.className = `word-box box${i} ${pinnedWords[i] ? 'pinned' : ''}`;
                box.onclick = () => selectBox(i);
                
                box.innerHTML = `
                    <div class="category-label">ãƒœãƒƒã‚¯ã‚¹${i}</div>
                    <div class="word-text" id="word${i}">${currentWords[i] || 'å˜èª' + i}</div>
                    <div class="hint">ã‚¯ãƒªãƒƒã‚¯ã—ã¦å¤‰æ›´</div>
                    <button class="pin-btn ${pinnedWords[i] ? 'pinned' : ''}" onclick="event.stopPropagation(); togglePin(${i})" title="ã“ã®å˜èªã‚’å›ºå®š/è§£é™¤">
                        ğŸ“Œ
                    </button>
                    <button class="dislike-btn" onclick="event.stopPropagation(); dislikeWord(${i})" title="ã“ã®å˜èªã‚’é™¤å¤–">
                        ğŸ‘
                    </button>
                `;
                
                container.appendChild(box);
            }
        }

        function setMode(mode) {
            currentMode = mode;
            
            // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            updateUI();
            
            // çµæœã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('replacementPanel').style.display = 'none';
            
            // å›ºå®šçŠ¶æ…‹ã¨ãƒ”ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            for (let i = 1; i <= boxCount; i++) {
                currentWords[i] = '';
                pinnedWords[i] = false;
            }
            
            if (bulkSelectMode) {
                toggleBulkSelectMode();
            }
        }

        function setActiveCategory(category) {
            activeCategory = category;
            updateCategoryTabs();
            updateWordList();
        }

        function getCurrentWords() {
            if (currentMode === 'mixed') {
                return mixedWords;
            } else {
                return categoryWords[activeCategory] || [];
            }
        }

        function setInputMode(mode) {
            inputMode = mode;
            
            document.getElementById('singleModeBtn').classList.remove('active');
            document.getElementById('bulkModeBtn').classList.remove('active');
            document.getElementById(mode + 'ModeBtn').classList.add('active');
            
            const singleSection = document.getElementById('singleInputSection');
            const bulkSection = document.getElementById('bulkInputSection');
            
            if (mode === 'single') {
                singleSection.classList.remove('hidden');
                bulkSection.classList.add('hidden');
            } else {
                singleSection.classList.add('hidden');
                bulkSection.classList.remove('hidden');
            }
        }

        function addWord() {
            const input = document.getElementById('wordInput');
            const word = input.value.trim();
            const currentWords = getCurrentWords();
            
            if (word && !currentWords.includes(word)) {
                currentWords.push(word);
                input.value = '';
                updateWordList();
                updateGenerateButton();
                showNotification(`ã€Œ${word}ã€ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼`);
            }
        }

        function addBulkWords() {
            const input = document.getElementById('bulkInput');
            const text = input.value.trim();
            
            if (!text) return;
            
            const words = parseBulkInput(text);
            const currentWords = getCurrentWords();
            let addedCount = 0;
            
            words.forEach(word => {
                if (word && !currentWords.includes(word)) {
                    currentWords.push(word);
                    addedCount++;
                }
            });
            
            if (addedCount > 0) {
                input.value = '';
                updateWordList();
                updateGenerateButton();
                showNotification(`${addedCount}å€‹ã®å˜èªã‚’è¿½åŠ ã—ã¾ã—ãŸï¼`);
            } else {
                showNotification('è¿½åŠ ã§ãã‚‹æ–°ã—ã„å˜èªãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚', 'warning');
            }
        }

        function parseBulkInput(text) {
            return text
                .split(/[\n,\s]+/)
                .map(word => word.trim())
                .filter(word => word.length > 0);
        }

        function clearBulkInput() {
            document.getElementById('bulkInput').value = '';
        }

        function removeWord(word) {
            if (currentMode === 'mixed') {
                mixedWords = mixedWords.filter(w => w !== word);
            } else {
                const words = categoryWords[activeCategory] || [];
                categoryWords[activeCategory] = words.filter(w => w !== word);
            }
            updateWordList();
            updateGenerateButton();
            updateExcludedWordsSection();
        }

        function updateWordList() {
            const wordList = document.getElementById('wordList');
            const currentWords = getCurrentWords();
            
            if (currentWords.length === 0) {
                wordList.innerHTML = '<div class="empty-state">ã¾ã å˜èªãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</div>';
                return;
            }
            
            let categoryClass = '';
            if (currentMode === 'category') {
                categoryClass = `box${activeCategory}`;
            }
            
            wordList.innerHTML = currentWords.map(word => {
                const isSelected = selectedWords.has(word);
                const selectableClass = bulkSelectMode ? 'selectable' : '';
                const selectedClass = isSelected ? 'selected' : '';
                const selectionIndicator = isSelected ? '<span class="selection-indicator">âœ“</span>' : '';
                
                if (bulkSelectMode) {
                    return `
                        <div class="word-tag ${categoryClass} ${selectableClass} ${selectedClass}" onclick="toggleWordSelection('${word}')">
                            ${word}
                            ${selectionIndicator}
                        </div>
                    `;
                } else {
                    return `
                        <div class="word-tag ${categoryClass}">
                            ${word}
                            <button class="remove-btn" onclick="removeWord('${word}')">Ã—</button>
                        </div>
                    `;
                }
            }).join('');
        }

        function toggleBulkSelectMode() {
            bulkSelectMode = !bulkSelectMode;
            const btn = document.getElementById('bulkSelectBtn');
            const bulkDeleteSection = document.getElementById('bulkDeleteSection');
            
            if (bulkSelectMode) {
                btn.textContent = 'âŒ é¸æŠãƒ¢ãƒ¼ãƒ‰çµ‚äº†';
                btn.classList.add('active');
                bulkDeleteSection.style.display = 'block';
            } else {
                btn.textContent = 'âœ… ã¾ã¨ã‚ã¦å‰Šé™¤';
                btn.classList.remove('active');
                bulkDeleteSection.style.display = 'none';
                selectedWords.clear();
            }
            
            updateWordList();
            updateSelectedCount();
        }

        function toggleWordSelection(word) {
            if (!bulkSelectMode) return;
            
            if (selectedWords.has(word)) {
                selectedWords.delete(word);
            } else {
                selectedWords.add(word);
            }
            
            updateWordList();
            updateSelectedCount();
        }

        function selectAllWords() {
            const currentWords = getCurrentWords();
            selectedWords.clear();
            currentWords.forEach(word => selectedWords.add(word));
            updateWordList();
            updateSelectedCount();
        }

        function deselectAllWords() {
            selectedWords.clear();
            updateWordList();
            updateSelectedCount();
        }

        function updateSelectedCount() {
            const countElement = document.getElementById('selectedCount');
            const deleteBtn = document.getElementById('deleteSelectedBtn');
            
            countElement.textContent = selectedWords.size;
            deleteBtn.disabled = selectedWords.size === 0;
        }

        function deleteSelectedWords() {
            if (selectedWords.size === 0) return;
            
            const count = selectedWords.size;
            const currentWords = getCurrentWords();
            
            // é¸æŠã•ã‚ŒãŸå˜èªã‚’å‰Šé™¤
            selectedWords.forEach(word => {
                const index = currentWords.indexOf(word);
                if (index > -1) {
                    currentWords.splice(index, 1);
                }
            });
            
            selectedWords.clear();
            updateWordList();
            updateGenerateButton();
            updateExcludedWordsSection();
            updateSelectedCount();
            
            showNotification(`${count}å€‹ã®å˜èªã‚’å‰Šé™¤ã—ã¾ã—ãŸ`, 'warning');
        }

        function cancelSelection() {
            toggleBulkSelectMode();
        }

        function updateGenerateButton() {
            const generateBtn = document.getElementById('generateBtn');
            
            if (currentMode === 'mixed') {
                generateBtn.disabled = mixedWords.length < boxCount;
            } else {
                let hasEnoughWords = true;
                for (let i = 1; i <= boxCount; i++) {
                    if ((categoryWords[i] || []).length === 0) {
                        hasEnoughWords = false;
                        break;
                    }
                }
                generateBtn.disabled = !hasEnoughWords;
            }
        }

        function generateRandomCombination() {
            if (currentMode === 'mixed') {
                if (mixedWords.length < boxCount) return;
                
                const shuffled = [...mixedWords].sort(() => Math.random() - 0.5);
                for (let i = 1; i <= boxCount; i++) {
                    if (!pinnedWords[i]) {
                        currentWords[i] = shuffled[i - 1] || mixedWords[Math.floor(Math.random() * mixedWords.length)];
                    }
                }
            } else {
                for (let i = 1; i <= boxCount; i++) {
                    if (!pinnedWords[i]) {
                        const words = categoryWords[i] || [];
                        if (words.length > 0) {
                            currentWords[i] = words[Math.floor(Math.random() * words.length)];
                        }
                    }
                }
            }
            
            // UIã‚’æ›´æ–°
            for (let i = 1; i <= boxCount; i++) {
                const wordElement = document.getElementById(`word${i}`);
                if (wordElement) {
                    wordElement.textContent = currentWords[i];
                }
            }
            
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('replacementPanel').style.display = 'none';
            
            // é¸æŠçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            for (let i = 1; i <= boxCount; i++) {
                const box = document.querySelector(`.word-box.box${i}`);
                if (box) {
                    box.classList.remove('active');
                }
            }
            selectedBox = 0;
        }

        function selectBox(boxNumber) {
            // å‰ã®é¸æŠã‚’ãƒªã‚»ãƒƒãƒˆ
            for (let i = 1; i <= boxCount; i++) {
                const box = document.querySelector(`.word-box.box${i}`);
                if (box) {
                    box.classList.remove('active');
                }
            }
            
            // æ–°ã—ã„é¸æŠã‚’è¨­å®š
            selectedBox = boxNumber;
            const selectedBoxElement = document.querySelector(`.word-box.box${boxNumber}`);
            if (selectedBoxElement) {
                selectedBoxElement.classList.add('active');
            }
            
            showReplacementPanel();
        }

        function showReplacementPanel() {
            const panel = document.getElementById('replacementPanel');
            const replacementWords = document.getElementById('replacementWords');
            
            let availableWords = [];
            const currentWord = currentWords[selectedBox];
            
            if (currentMode === 'mixed') {
                availableWords = mixedWords.filter(word => word !== currentWord);
            } else {
                const words = categoryWords[selectedBox] || [];
                availableWords = words.filter(word => word !== currentWord);
            }
            
            replacementWords.innerHTML = availableWords.map(word => `
                <div class="replacement-word" onclick="replaceWord('${word}')">
                    ${word}
                </div>
            `).join('');
            
            panel.style.display = 'block';
        }

        function replaceWord(newWord) {
            if (selectedBox > 0 && selectedBox <= boxCount) {
                currentWords[selectedBox] = newWord;
                const wordElement = document.getElementById(`word${selectedBox}`);
                if (wordElement) {
                    wordElement.textContent = newWord;
                }
                
                // æ‰‹å‹•ã§å¤‰æ›´ã—ãŸå ´åˆã¯å›ºå®šã‚’è§£é™¤
                if (pinnedWords[selectedBox]) {
                    pinnedWords[selectedBox] = false;
                    updatePinDisplay(selectedBox, false);
                }
            }
            
            // ãƒ‘ãƒãƒ«ã‚’éš ã™
            document.getElementById('replacementPanel').style.display = 'none';
            
            // é¸æŠçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            for (let i = 1; i <= boxCount; i++) {
                const box = document.querySelector(`.word-box.box${i}`);
                if (box) {
                    box.classList.remove('active');
                }
            }
            selectedBox = 0;
        }

        function togglePin(boxNumber) {
            pinnedWords[boxNumber] = !pinnedWords[boxNumber];
            updatePinDisplay(boxNumber, pinnedWords[boxNumber]);
            
            const word = currentWords[boxNumber];
            const isPinned = pinnedWords[boxNumber];
            
            showNotification(
                `ã€Œ${word}ã€ã‚’${isPinned ? 'å›ºå®š' : 'å›ºå®šè§£é™¤'}ã—ã¾ã—ãŸ`,
                isPinned ? 'success' : 'warning'
            );
        }

        function updatePinDisplay(boxNumber, isPinned) {
            const box = document.querySelector(`.word-box.box${boxNumber}`);
            const btn = document.querySelector(`.word-box.box${boxNumber} .pin-btn`);
            
            if (box && btn) {
                if (isPinned) {
                    box.classList.add('pinned');
                    btn.classList.add('pinned');
                    btn.title = 'ã“ã®å˜èªã®å›ºå®šã‚’è§£é™¤';
                } else {
                    box.classList.remove('pinned');
                    btn.classList.remove('pinned');
                    btn.title = 'ã“ã®å˜èªã‚’å›ºå®š';
                }
            }
        }

        function dislikeWord(boxNumber) {
            const wordToExclude = currentWords[boxNumber];
            
            if (currentMode === 'mixed') {
                mixedWords = mixedWords.filter(w => w !== wordToExclude);
                if (!excludedMixedWords.includes(wordToExclude)) {
                    excludedMixedWords.push(wordToExclude);
                }
            } else {
                const words = categoryWords[boxNumber] || [];
                categoryWords[boxNumber] = words.filter(w => w !== wordToExclude);
                if (!excludedCategoryWords[boxNumber]) {
                    excludedCategoryWords[boxNumber] = [];
                }
                if (!excludedCategoryWords[boxNumber].includes(wordToExclude)) {
                    excludedCategoryWords[boxNumber].push(wordToExclude);
                }
            }
            
            updateWordList();
            updateGenerateButton();
            updateExcludedWordsSection();
            
            if (bulkSelectMode) {
                toggleBulkSelectMode();
            }
            
            generateRandomCombination();
            showNotification(`ã€Œ${wordToExclude}ã€ã‚’é™¤å¤–ã—ã¾ã—ãŸ`, 'warning');
        }

        function restoreWord(word) {
            if (currentMode === 'mixed') {
                excludedMixedWords = excludedMixedWords.filter(w => w !== word);
                if (!mixedWords.includes(word)) {
                    mixedWords.push(word);
                }
            } else {
                for (let i = 1; i <= boxCount; i++) {
                    if (excludedCategoryWords[i] && excludedCategoryWords[i].includes(word)) {
                        excludedCategoryWords[i] = excludedCategoryWords[i].filter(w => w !== word);
                        if (!categoryWords[i]) categoryWords[i] = [];
                        if (!categoryWords[i].includes(word)) {
                            categoryWords[i].push(word);
                        }
                    }
                }
            }
            
            updateWordList();
            updateGenerateButton();
            updateExcludedWordsSection();
            showNotification(`ã€Œ${word}ã€ã‚’å¾©æ´»ã•ã›ã¾ã—ãŸ`, 'success');
        }

        function updateExcludedWordsSection() {
            const section = document.getElementById('excludedWordsSection');
            const container = document.getElementById('excludedWords');
            
            let excludedWords = [];
            if (currentMode === 'mixed') {
                excludedWords = excludedMixedWords;
            } else {
                for (let i = 1; i <= boxCount; i++) {
                    if (excludedCategoryWords[i]) {
                        excludedWords = excludedWords.concat(excludedCategoryWords[i]);
                    }
                }
            }
            
            if (excludedWords.length === 0) {
                section.style.display = 'none';
                return;
            }
            
            section.style.display = 'block';
            container.innerHTML = excludedWords.map(word => `
                <div class="excluded-word" onclick="restoreWord('${word}')" title="ã‚¯ãƒªãƒƒã‚¯ã§å¾©æ´»">
                    ${word}
                </div>
            `).join('');
        }

        // ãƒ—ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½
        function showPresetPanel() {
            const panel = document.getElementById('presetPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            updateCurrentWordsCount();
            displayPresets();
            updateBackupInfo();
        }

        function hidePresetPanel() {
            document.getElementById('presetPanel').style.display = 'none';
        }

        function updateCurrentWordsCount() {
            let totalWords = 0;
            if (currentMode === 'mixed') {
                totalWords = mixedWords.length;
            } else {
                for (let i = 1; i <= boxCount; i++) {
                    totalWords += (categoryWords[i] || []).length;
                }
            }
            document.getElementById('currentWordsCount').textContent = totalWords;
        }

        function saveCurrentPreset() {
            const nameInput = document.getElementById('presetNameInput');
            const presetName = nameInput.value.trim();
            
            if (!presetName) {
                showNotification('ãƒ—ãƒªã‚»ãƒƒãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'warning');
                return;
            }
            
            let totalWords = 0;
            if (currentMode === 'mixed') {
                totalWords = mixedWords.length;
            } else {
                for (let i = 1; i <= boxCount; i++) {
                    totalWords += (categoryWords[i] || []).length;
                }
            }
            
            if (totalWords === 0) {
                showNotification('ä¿å­˜ã™ã‚‹å˜èªãŒã‚ã‚Šã¾ã›ã‚“', 'warning');
                return;
            }
            
            // ãƒ—ãƒªã‚»ãƒƒãƒˆä¿å­˜
            const presetId = `preset_${Date.now()}_${presetCounter++}`;
            savedPresets[presetId] = {
                name: presetName,
                mode: currentMode,
                boxCount: boxCount,
                mixedWords: [...mixedWords],
                categoryWords: {},
                excludedMixedWords: [...excludedMixedWords],
                excludedCategoryWords: {},
                createdAt: new Date().toLocaleString(),
                wordCount: totalWords
            };
            
            // ã‚«ãƒ†ã‚´ãƒªãƒ¯ãƒ¼ãƒ‰ã‚‚ã‚³ãƒ”ãƒ¼
            for (let i = 1; i <= 10; i++) {
                savedPresets[presetId].categoryWords[i] = categoryWords[i] ? [...categoryWords[i]] : [];
                savedPresets[presetId].excludedCategoryWords[i] = excludedCategoryWords[i] ? [...excludedCategoryWords[i]] : [];
            }
            
            savePresets();
            
            nameInput.value = '';
            displayPresets();
            showNotification(`ã€Œ${presetName}ã€ã‚’ä¿å­˜ã—ã¾ã—ãŸ`, 'success');
        }

        function loadPreset(presetId) {
            const preset = savedPresets[presetId];
            if (!preset) {
                showNotification('ãƒ—ãƒªã‚»ãƒƒãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            
            // ãƒ¢ãƒ¼ãƒ‰ã‚’åˆ‡ã‚Šæ›¿ãˆ
            if (preset.mode !== currentMode) {
                currentMode = preset.mode;
                updateModeUI();
            }
            
            // ãƒœãƒƒã‚¯ã‚¹æ•°ã‚’è¨­å®š
            boxCount = preset.boxCount || 2;
            
            // å˜èªã‚’ãƒ­ãƒ¼ãƒ‰
            mixedWords.length = 0;
            mixedWords.push(...preset.mixedWords);
            excludedMixedWords.length = 0;
            excludedMixedWords.push(...preset.excludedMixedWords);
            
            for (let i = 1; i <= 10; i++) {
                categoryWords[i] = preset.categoryWords[i] ? [...preset.categoryWords[i]] : [];
                excludedCategoryWords[i] = preset.excludedCategoryWords[i] ? [...preset.excludedCategoryWords[i]] : [];
            }
            
            updateUI();
            hidePresetPanel();
            
            showNotification(`ã€Œ${preset.name}ã€ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ (${preset.wordCount}å€‹ã®å˜èª)`, 'success');
        }

        function deletePreset(presetId) {
            const preset = savedPresets[presetId];
            if (!preset) return;
            
            if (confirm(`ã€Œ${preset.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                delete savedPresets[presetId];
                savePresets();
                displayPresets();
                showNotification(`ã€Œ${preset.name}ã€ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`, 'warning');
            }
        }

        function displayPresets() {
            const presetList = document.getElementById('presetList');
            const presets = Object.entries(savedPresets);
            
            if (presets.length === 0) {
                presetList.innerHTML = '<div class="no-presets">ä¿å­˜ã•ã‚ŒãŸãƒ—ãƒªã‚»ãƒƒãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            presetList.innerHTML = presets.map(([id, preset]) => `
                <div class="preset-item">
                    <div class="preset-item-header">
                        <div class="preset-name">${preset.name}</div>
                    </div>
                    <div class="preset-info">
                        ${preset.wordCount}å€‹ã®å˜èª | ${preset.mode === 'mixed' ? 'ãƒŸãƒƒã‚¯ã‚¹ãƒ¢ãƒ¼ãƒ‰' : 'ã‚«ãƒ†ã‚´ãƒªãƒ¢ãƒ¼ãƒ‰'} | ãƒœãƒƒã‚¯ã‚¹æ•°: ${preset.boxCount} | ${preset.createdAt}
                    </div>
                    <div class="preset-actions">
                        <button class="load-preset-btn" onclick="loadPreset('${id}')">ãƒ­ãƒ¼ãƒ‰</button>
                        <button class="delete-preset-btn" onclick="deletePreset('${id}')">å‰Šé™¤</button>
                    </div>
                </div>
            `).join('');
        }

        function updateModeUI() {
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            if (currentMode === 'mixed') {
                document.querySelector('.mode-btn').classList.add('active');
            } else {
                document.querySelectorAll('.mode-btn')[1].classList.add('active');
            }
        }

        function savePresets() {
            // ãƒ¡ãƒ¢ãƒªå†…ã«ä¿æŒï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã§ã¯localStorageã¯ä½¿ç”¨ä¸å¯ï¼‰
        }

        function loadPresets() {
            // åˆæœŸåŒ–ã®ã¿
            savedPresets = {};
        }

        // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚·ã‚¹ãƒ†ãƒ 
        function initializeBackupSystem() {
            loadBackups();
            startAutoBackup();
            updateBackupInfo();
        }

        function startAutoBackup() {
            // 5åˆ†ã”ã¨ã«è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
            autoBackupInterval = setInterval(() => {
                createAutoBackup();
            }, 300000); // 5åˆ†
        }

        function createAutoBackup() {
            const backupId = `auto_${Date.now()}_${backupCounter++}`;
            const currentData = getCurrentAppState();
            
            backupData[backupId] = {
                type: 'auto',
                name: `è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— ${new Date().toLocaleString()}`,
                data: currentData,
                createdAt: new Date().toLocaleString(),
                timestamp: Date.now()
            };
            
            cleanupOldAutoBackups();
            
            lastAutoBackup = new Date().toLocaleString();
            saveBackups();
            updateBackupInfo();
        }

        function createManualBackup() {
            const backupId = `manual_${Date.now()}_${backupCounter++}`;
            const currentData = getCurrentAppState();
            
            backupData[backupId] = {
                type: 'manual',
                name: `æ‰‹å‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— ${new Date().toLocaleString()}`,
                data: currentData,
                createdAt: new Date().toLocaleString(),
                timestamp: Date.now()
            };
            
            saveBackups();
            updateBackupInfo();
            showNotification('æ‰‹å‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆã—ã¾ã—ãŸ', 'success');
        }

        function getCurrentAppState() {
            return {
                boxCount: boxCount,
                mixedWords: [...mixedWords],
                categoryWords: {...categoryWords},
                excludedMixedWords: [...excludedMixedWords],
                excludedCategoryWords: {...excludedCategoryWords},
                savedPresets: {...savedPresets},
                currentMode: currentMode,
                activeCategory: activeCategory,
                currentWords: {...currentWords},
                pinnedWords: {...pinnedWords}
            };
        }

        function restoreFromBackup(backupId) {
            const backup = backupData[backupId];
            if (!backup) {
                showNotification('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            
            if (!confirm(`ã€Œ${backup.name}ã€ã‚’å¾©å…ƒã—ã¾ã™ã‹ï¼Ÿç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã¯å¤±ã‚ã‚Œã¾ã™ã€‚`)) {
                return;
            }
            
            const data = backup.data;
            
            // ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
            boxCount = data.boxCount || 2;
            mixedWords.length = 0;
            mixedWords.push(...data.mixedWords);
            categoryWords = {...data.categoryWords};
            excludedMixedWords.length = 0;
            excludedMixedWords.push(...data.excludedMixedWords);
            excludedCategoryWords = {...data.excludedCategoryWords};
            
            savedPresets = {...data.savedPresets};
            currentMode = data.currentMode;
            activeCategory = data.activeCategory;
            currentWords = {...data.currentWords};
            pinnedWords = {...data.pinnedWords};
            
            // UIã‚’æ›´æ–°
            updateModeUI();
            updateUI();
            displayPresets();
            
            hideBackupList();
            showNotification(`ã€Œ${backup.name}ã€ã‹ã‚‰å¾©å…ƒã—ã¾ã—ãŸ`, 'success');
        }

        function exportBackup() {
            const exportData = {
                backups: backupData,
                appState: getCurrentAppState(),
                exportDate: new Date().toLocaleString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `game-word-combiner-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ', 'success');
        }

        function importBackup(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importData = JSON.parse(e.target.result);
                    
                    if (!importData.backups || !importData.appState) {
                        throw new Error('ç„¡åŠ¹ãªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™');
                    }
                    
                    if (confirm('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã‹ï¼Ÿç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚')) {
                        Object.assign(backupData, importData.backups);
                        saveBackups();
                        updateBackupInfo();
                        showNotification('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ', 'success');
                    }
                } catch (error) {
                    showNotification('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            };
            reader.readAsText(file);
            
            event.target.value = '';
        }

        function showBackupList() {
            const panel = document.getElementById('backupListPanel');
            panel.style.display = 'block';
            displayBackups();
        }

        function hideBackupList() {
            document.getElementById('backupListPanel').style.display = 'none';
        }

        function displayBackups() {
            const backupList = document.getElementById('backupList');
            const backups = Object.entries(backupData).sort((a, b) => b[1].timestamp - a[1].timestamp);
            
            if (backups.length === 0) {
                backupList.innerHTML = '<div class="no-backups">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            backupList.innerHTML = backups.map(([id, backup]) => `
                <div class="backup-item">
                    <div class="backup-item-header">
                        <div class="backup-name">${backup.name}</div>
                        <div class="backup-type">${backup.type === 'auto' ? 'è‡ªå‹•' : 'æ‰‹å‹•'}</div>
                    </div>
                    <div class="backup-info-detail">
                        ä½œæˆæ—¥æ™‚: ${backup.createdAt}
                    </div>
                    <div class="backup-actions-detail">
                        <button class="restore-btn" onclick="restoreFromBackup('${id}')">å¾©å…ƒ</button>
                        <button class="delete-backup-btn" onclick="deleteBackup('${id}')">å‰Šé™¤</button>
                    </div>
                </div>
            `).join('');
        }

        function deleteBackup(backupId) {
            const backup = backupData[backupId];
            if (!backup) return;
            
            if (confirm(`ã€Œ${backup.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                delete backupData[backupId];
                saveBackups();
                updateBackupInfo();
                displayBackups();
                showNotification('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'warning');
            }
        }

        function cleanupOldAutoBackups() {
            const autoBackups = Object.entries(backupData)
                .filter(([id, backup]) => backup.type === 'auto')
                .sort((a, b) => b[1].timestamp - a[1].timestamp);
            
            if (autoBackups.length > 10) {
                autoBackups.slice(10).forEach(([id]) => {
                    delete backupData[id];
                });
            }
        }

        function updateBackupInfo() {
            const autoBackupTime = document.getElementById('autoBackupTime');
            const backupCount = document.getElementById('backupCount');
            
            autoBackupTime.textContent = lastAutoBackup || 'æœªå®Ÿè¡Œ';
            backupCount.textContent = Object.keys(backupData).length;
        }

        function saveBackups() {
            // ãƒ¡ãƒ¢ãƒªå†…ã«ä¿æŒ
        }

        function loadBackups() {
            backupData = {};
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#00b894' : type === 'warning' ? '#fdcb6e' : '#ff6b6b'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 1000;
                animation: slideInRight 0.3s ease;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Enterã‚­ãƒ¼ã§å˜èªã‚’è¿½åŠ 
        document.getElementById('wordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addWord();
            }
        });

        // ã‚¢ãƒ—ãƒªåˆæœŸåŒ–
        initializeApp();
    </script>
</body>
</html>
